<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<title>Products</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<h2>Products</h2>
<button id="loadProducts">Load Products</button>
<table border="1" id="productTable">
<thead>
<tr><th>ID</th><th>Title</th><th>Price</th><th>Category</th></tr>
</thead>
<tbody></tbody>
</table>

<script>
$("#loadProducts").click(function() {
    $.ajax({
        url: "/graphql",
        type: "POST",
        contentType: "application/json",
        data: JSON.stringify({ query: "{ allProductsSorted { id title price category { name } } }" }),
        success: function(res) {
            let products = res.data.allProductsSorted;
            let tbody = $("#productTable tbody");
            tbody.empty();
            products.forEach(p => {
                tbody.append(`<tr>
                    <td>${p.id}</td>
                    <td>${p.title}</td>
                    <td>${p.price}</td>
                    <td>${p.category.name}</td>
                </tr>`);
            });
        }
    });
});
</script>
</body>
</html>
